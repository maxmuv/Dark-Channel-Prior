# Dark-Channel-Prior
### Технические требования

Для запуска скриптов на python:
	python >= 3.7
	

### Составные части проекта
#### Библиотеки
##### Haze Model
Статическая библиотека для аугментации и удаления тумана. В ней реализованы класс HazeModel и функция CreateTransmission. Объект HazeModel содержит передачу цвета от объектов(transmission, $t(x)$), свет атмосферы(atmosphere's light, $\vec{A}$) и минимальную передачу($t_0$). Он добавляет дымку на трехканальное изображение типа double или снимает с него согласно параметрам по следующей формуле:

$$f(x).$$  

Функция по одноканальной матрице типа double, проинициализированной картой глубины $d(x)$ и параметру $\beta$ создает передачу согласно формуле:

$$f(x)$$.

Во всех функциях библиотеки использую матрицы типа double cv::Mat с диапозоном значений (0, 1).

###### Тесты
* *test_haze_model* - тест для класса HazeModel и его методов. Методы тестируются на небольших матрицах, результат для которых легко посчитать вручную. Полученные матрицы сравниваются с изначально посчитанными.

* *test_transmission_creation* - аналогично для функции CreateTransmission.

### Используемые скрипты на python

Перед использованием скриптов стоит установить зависимости:

```console
    pip install -r requirements.txt
```

Сами скрипты:

* *diode_sampler.py* - скрипт, который для outdoor директории датасета DIODE[2] создает в выходной директории две папки, одна из которых - с изображениями, другая - с картами глубины, сохраненными в виде серых изображений. В [2] использовался сенсор с диапазоном в 0.5-350м, поэтому для неба и некоторый движущихся объектов значения получились невалидными. Для этих пикселей в картах глубины сделал значение в 2 раза больше максимальной глубины. Картинки и карты глубины для аугментации были сделаны из сплита DIODE для валидации.

### Примеры 
Входное изображение из датасета DIODE[2] c картой глубины(изображения 1-2).

![Input image](result_pdf/00022_00193_outdoor_000_000.png){ width=200 }

![Depth map](result_pdf/00022_00193_outdoor_000_000(1).png){ width=200 }

### Тестирование

Приложение собрано и протестировано на:

1. ###### Linux

2. ###### Windows:

    *Visual Studio Code*:

        Генератор CMake - "Visual Studio 15 2017"

        CMake - 3.20.1

        MSVC - 19.16.27045.0

        OpenCV - 4.5.5

### Ссылки:

2. Vasiljevic I. et al. Diode: A dense indoor and outdoor depth dataset //arXiv preprint arXiv:1908.00463. – 2019.